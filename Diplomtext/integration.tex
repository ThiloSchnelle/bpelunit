In disem Abschnitt werden zuerst zwei Möglichkeiten für die Integration der Messung der Testabdeckung in das Framework vorgestellt. Nach einem Vergleich der beiden Ansätze wird einen als Lösung ausgewählt

Die Aufgabe 

die SOAP-Nachrichten, die an Coverage Receiver gerichtet sind müssen dekodiert werden und  an den Servece (Mock) weitergeleitet werden.  

Ansatz1
Es kann ein spezieller Partner Track für den Service definiert und zu jedem TestCase zugeordnet werden. Zu jedem TestCase kann dann ein Thread gestartet werden, der die Coverage Nachrichten empfängt. Es reicht aus jedem TestCase aus. Es muss die Logik für den Manager der Marken implementiert werden. Dafür kann entweder die receive Aktivität mehrmals hintereinander geschaltet werden, oder eine neue Aktivität, die alle Nachrichten akzeptiert.



 Das Framework dekodiert und leitet weiter , man braucht sich keine Gedanken zu machen. 

nachteil größere Eingriffe in das Framework und an vielen Stellen:
\begin{itemize}
	\item beim Start jedes Testcases muss ein zusätzliches Thread gestartet werden
	\item beim shutdown unberücksichtigt 
	\item beim Auswerten des Ergebnissen muss dieser Thread unberücksichtigt bleiben 
\end{itemize}



Ansatz2

Direkt nachdem Empfangen der Nachricht wird diese an den Receiver weitergeleitet. Dieser muss sich um die Dekodierung der SOAP Nachrichten kümmern


Dadurch dass beim ersten Ansatz die ganze Funktionalität  der Kommunikation (der Übermittlung und Dekodierung der Nachrichten) durch das Framework erledigt werden erscheint diese Möglichkeit als eleganter. Aber Velangsamen





 
 \begin{figure}[htbp]
	\centering
		\includegraphics[width=0.9\textwidth]{bilder/bpelunit-architecture-with-coverage.pdf}
		\caption{Kontrollfluss eines BPEL Prozesses}
	\label{fig:ExamlpleBPELProzess}
\end{figure}

BPELUnit Framework wird erweitert durch hinzufügen einer Phase vor dem tatsächlichen Testen. In dieser Phase wird der BPEL Prozess annotiert , invoke-Aktivitäten werdenhnzugefügt. Diese Aktivitäteb sind Markierungen für jede Aktivität und jede Möglichkeit des Kontrollflusses. Die Marken haben eindeutige Identifizierungen, die verwendet werden umd die Relation zwischen Marken und Aktivitäten bzw. dem Kontrollfluß 

Zur Laufzeit diese Aktivitöäten rufen ein Web Service des BPELUnit Frameworks . Bei diesen Aufrufen werden die Marken transportiert. , die signalisieren den Asführungspfad zum BPELUnit Framework. Diesse Marken werden auf den BPEL Prozess abgebildet. Nach der Ausführung können mit Hilfe der Marken und statischen Informationen über BPEL Prozess die Abdeckungsmetriken berechnet werden. Es ist ein neuer Modul hinzugekommen, der alle Aufgaben, die mit der Messung der Abdeckung zu tun haben, managt. So enthält dieser Modul einen Instrumentierer der den BPEL file analysiert und Annotationen hinzufügt. Der alte File wird durch den neuen ersetzt.  Zusätzlich ist ein Web Service für das Empfangen von Marken in diesem Modul enhalten