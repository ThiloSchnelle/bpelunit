Eine der wichtigsten Aufgaben bei der
Entwicklung von komplexer, umfangreicher Software ist die Prüfung. In
der Praxis wird dafür ein erheblicher Anteil des
gesamten Entwicklungsaufwands aufgebracht. Es
existieren zahlreiche Methoden und Techniken für die
Prüfung von Software. Testen ist ein in der konventionellen Softwareentwicklung unentbehrliches Mittel zur Qualitätssicherung.

\textit{Testen ist ein Prozess, ein Programm mit der Absicht
auszuführen, Fehler zu finden.}

Beim Testen von BPEL-Prozessen müssen im Vergleich zu anderen Anwendungen eine Besonderheit beachtet werden: externe Abhängigkeit in Form von Web Services. Die Durchführung eines kompletten Tests ist nur dann möglich, wenn alle beteiligten Web Services erreichbar sind und reproduzierbare Ergebnisse liefern. 
Zum richtigen Problem wird das Testen, wenn externe Service-Anbietern eingebunden sind. In der Regel hat man in dieser Situation nur die Beschreibung der Schnittstelle aber kein Quellcode. Aus diesem Grund kann ein Web Service in einer Testumgebung repliziert werden. 
Ein weiteres Problem ist das Testen von Fehlersituationen. Dafür müssen die solche Situationen, wie "`Web Service nicht erreichbar"' oder "`antwortet mit einer Fehlermeldung"' simuliert werden. \cite{LuebketestSOA} 

Die angestrebte Isolation des BPEL-Prozesses für das Testen kann mit Hilfe eines Unit-Tests erreicht werden. Im Rahmen einer Masterarbeit \cite{Mayer2006}  ist das BPELUnit-Framework entstanden, der das Testen von BPEL-Kompositionen in isolation ermöglicht.

\subsection{BPELUnit-Framework}
BPELUnit ist ein Framework zum Testen von BPEL-Kompositionen in Isolation. Es ermöglicht wiederholbare \textit{white-box}-Tests zu erstellen, zu speichern und auszuführen. 
Das Framework richtet sich primär an die Entwickler, die das Testen und Programmieren während des Entwicklungsprozesses abwechseln machen. 
Dementsprechend bietet das  Framework eine schnelle und einfache Möglichkeit, die erstellten Tests immer wieder auszuführen und Ergebnisse auszuwerten.
Der Kern ist unabhängig von der Präsentationsschicht implementiert und bietet eine Schnittstelle für die Implementierung der Clients an. Drei Clients gehören gehören zum Framework:
\begin{itemize}
	\item Befehlszeilen-Client 
	\item ANT-Integration 
		\item Eclipse-Plugin 
\end{itemize}
 Bei den ersten beiden Clients erfolgt die Konfiguration über XML-Dokumente, die im Konfigurationsverzechnis (\textit{conf}) der BPELUnit-Installation abgelegt sind. Eclipse-Plugin ermöglicht neben der grafischen Darstellung des Ergebnisses auch komfortable Erstellung der Tests mit Hilfe eines Editors.
 
 Das Framework unterstützt \textit{ActiveBPEL Engine} und \textit{Oracle BPEL Process Manager (Server)}. Weitere Engines können durch implementieren entsprechenden Adapter integriert werden.

BPELUnit isoliert den zu testenden Prozess, indem es die Partner des Prozesses durch Mock's ersetzt, die diese Partner simulieren. Dadurch können Abhängigkeiten von externen Services aufgelöst werden. Schnellere Tests ist der angenehme Nebeneffekt dieser Vorgehensweise, denn die Simulationen der Web Services meist schneller als reale Implementierungen sind. 

\textbf{BPELUnit-Architektur}. Das Framework basiert auf einer Schichtarchitektur, die in der Abbildung \ref{fig:schichtarchitektur} dargestellt ist. 
 Der erste von unten Schicht ist für die Testspezifikation zuständig und legt fest, wie die Testdaten und das Verhalten der Partner definiert werden. Die Tests werden in den Test Suiten organisiert, wofür die \textit{Test Organization}-Schicht verantwortlich ist. Die Ausführung der Tests wird in der dritten Schicht \textit{Test Execution} realisiert. \textit{Test Results}-Schicht sorgt für die Sammlung der Daten und Statistiken  während der Tests.  Im folgenden werden die einzelnen Schichten etwas näher erläutert.
 \begin{figure}[htbp]
	\centering
		\includegraphics[width=0.47\textwidth]{bilder/FrameworkLayer.png}
		\caption{Schichtarchitektur des BPELUnit-Frameworks \cite{Mayer2006}}
	\label{fig:schichtarchitektur}
\end{figure}
  
 
 \textbf{Testspezifikation}.
 Ein BPEL-Prozess hat einen Client und beliebige Anzahl von Partner. Die Partner bzw. die Web Services laufen parallel ab und interagieren dabei mit dem BPEL-Prozess. 
Das Verhalten der Partner (Mock's) während der Tests wird in den so genannten Testfällen (\textit{eng. Testcases}) definiert. Zu diesem Zweck werden für jeden Testfall so genannten \textit{Tracks} definiert: einen \textit{Client-Track} und beliebig viele \textsl{Partner-Tracks}. Die Tracks legen die Interaktionen der jeweiligen Partner mit dem BPEL-Prozess anhand von Sequenzen der atomaren Interaktionen (Aktivitäten) fest..
Dabei werden folgende Interaktionsmuster unterstützt: 
\begin{itemize}
	\item \textit{one way}-Interaktion: \textit{receive} oder \textit{reply},
	\item synchrone \textit{two way}-Interaktion: \textit{receive-reply} und \textit{reply-receive},
	\item asynchrone \textit{two way}-Interaktion: \textit{receive-reply} und \textit{reply-receive}.
\end{itemize}


 \begin{figure}[htbp]
	\centering
		\includegraphics[width=0.8\textwidth]{bilder/TestcaseSequence.pdf}
		\caption{BPELUnit - Sequenzen in einem Testfall \cite{Mayer2006}}
	\label{fig:sequenzen}
\end{figure}

Die Abbildung \ref{fig:sequenzen} zeigt das Zusammenspiel der Sequenzen eines Testfalls.

Durch Daten, die an den BPEL-Prozess verschickt werden, kann der Prozess gesteuert und bestimmte Zweige des Kontrollflusses stimuliert werden. Das Kenntnis der inneren Struktur ist vorausgesetzt (white-box-Test).
 Die Daten, die bei der Interaktion mit BPEL-Prozess verschickt werden, sind in XML spezifiziert. Es können WSDL-Nachrichten und sowohl einfache Datentypen als auch Elementen der XML Schema verwendet werden. Die Daten, die der BPEL-Prozess verschickt, können auf die Korrektheit überprüft werden. 
Für die Auswahl der relevanten Daten wird XPath \cite{W3C1999} verwendet. 

Mit der Fähigkeit des Frameworks, die SOAP Faults zu  empfangen und zu senden, steht dem Tester die Möglichkeit zur Verfügung, die Fault und Compensation Handler des BPEL-Prozesses zu testen.  
 
 
\textbf{Testorganisation}.  
Die einzelnen Testfälle werden wie in den konventionellen Programmiersprachen in einer \textit{suite} organisiert. \textit{Suite} referenziert alle für den Test notwendigen Elemente: zu testende BPEL-Komposition, WSDL-Beschreibungen, XML-Schemata usw. Außerdem definiert die Suite für alle enthaltenen Testfälle eine globale Testumgebung mit einer \textit{setup} und \textit{shutdown}-Routine, die für das \textit{Deployment} und \textit{Undeployment} des Prozesses zuständig ist. 

\textbf{Ausführung der Tests}. Zum Testen muss der BPEL-Prozess in einer Testumgebung ausgeführt werden, die die Input- und Output-Daten des BPEL-Prozesses entsprechend der Testspezifikation behandelt. \textit{Real-life}-Testen heißt der Ansatz, der bei BPELUnit-Framework dafür verwendet wird. Dabei wird der zu testende BPEL-Prozess in eine BPEL-Engine deployt und als Web Service aufgerufen. Die Partner-Web Services müssen dabei durch Mock's ersetzt werden, die das Verhalten der Web Services simulieren, d.h., Web Service-Aufrufe empfangen und/oder selbst absetzen.   Beim \textit{Deployen} des BPEL-Prozesses müssen alle URI's der Partner-Web Services durch die URI's der Mock's ersetzt werden. 

 \begin{figure}[htbp]
	\centering
		\includegraphics[width=0.75\textwidth]{bilder/BPLEUnitTestHarness.png}
		\caption{BPELUnit - Testumgebung \cite{Mayer2006}}
	\label{fig:loggingservice}
\end{figure} 

Die Testumgebung ist neben der Simulation der Partner auch für die Kommunikation mit dem BPEL-Prozess verantwortlich, die über SOAP-Nachrichten stattfinden. Zu diesem Zweck simuliert BPELUnit den kompletten Web Service Stack und kommt mit allen wichtigen SOAP-Konstrukten zu recht. Das Framework erledigt sowohl das Verpacken der Daten in SOAP-Nachrichten als auch dekodieren der empfangenen SOAP-Nachrichten (Abbildung \ref{fig:bpelmiddleware}) und übernimmt damit dem Tester viel Arbeit.
  
  
 \begin{figure}[htbp]
	\centering
		\includegraphics[width=0.98\textwidth]{bilder/BPELUnitMiddleware.pdf}
		\caption{Kommunikation zwischen BPEL-Prozess und simulierten Partnern \cite{Mayer2006}}
	\label{fig:bpelmiddleware}
\end{figure}


Für das \textit{Deployment} eines BPEL-Prozesses sind anbieterspezifische \textit{Deployment Descriptoren} erforderlich, die nicht standardisiert sind. Das \textit{Deployen} des BPEL-Prozesses ist, wie bereits erläutert notwendig, und wird durch BPELUnit automatisch ausgeführt. Dazu muss für die jeweilige Engine ein entsprechendes Adapter implementiert werden.


\textbf{Testergebnisse}.
Beim Testen wird der BPEL-Prozess in einer Engine ausgeführt. Der beschränkte Zugriff auf den Prozess (bedingt durch die Ausführung in einer BPEL-Engine) während der Tests erschwert die Sammlung der Information über die Ausführung wesentlich. BPELUnit kann nur berichten, ob der Testfall erfolgreich war oder nicht. Im Fehlerfall 
werden zwei Typen von Fehlern unterschieden:
\begin{itemize}
	\item Fehler auf der Anwendungsebene - zum Beispiel eine erwartete Nachricht von BPEL ist nicht angekommen, oder enthält falsche Informationen oder zu viele Nachrichten sind angekommen,
	\item Fehler auf der Kommunikationsebene - Problem mit dem Web Service Stack.
\end{itemize}

Eine wichtige Information beim Testen ist die erreichte Testabdeckung. Das BPELUnit-Framework wird im praktischen Teil mit der Funktionalität der Ermittlung von  Testabdeckung erweitert.
 
  
