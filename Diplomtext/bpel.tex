BPEL ist eine XML-basierte, ausführbare Sprache zur Modellierung und Beschreibung
von Geschäftsprozessen. BPEL ist 2002 aus IBMs WSFL und Microsofts XLANG entstanden und liegt aktuell in der Version 2.0  als OASIS Standard vor. Durch breite Produktunterstützung ist die Sprache auf dem Weg, sich auch als Industriestandard zu etabliert.


Mit BPEL lässt sich ein Prozess beschreiben, der verschiedene Dienste zu einer Gesamtanwendung verknüpft. Web Services können auf zwei Arten kombiniert werden:
\begin{itemize}
	\item \textbf{Orchestration:} Ein zentraler Prozess koordiniert die
Operationen der Web Services, die in den Prozess
eingebunden sind.
\item \textbf{Choreography:} Es gibt keinen zentralen Koordinator. Jeder in
die Choreography eingebunden Web Service "weiss", mit
wem er zu interagieren hat. Bei der Choreographie erfolgt
die Zusammenarbeit über den Austausch von Nachrichten
in einem öffentlichen Prozess.
\end{itemize}

BPEL unterstützt Orchestration und Choreography durch
\begin{itemize}
	\item \textbf{Executable Processes:} Spezifikation des intenen Verahaltens eines
Geschäftsprozesses, der durch eine Engine
ausgeführt werden kann. Enthält alle für die Prozessausführung notwendige Informationen bis auf die tatsächlichen Endpunkte der Web Services.
\item \textbf{Abstract Business Processes:} Spezifikation des
Nachrichtenaustauschs zwischen Partnern. Beschreibung des nach außen sichbaren Verhaltens des Prozesses. Keine Aussagen über interne Logik.
\end{itemize}

Während abstrakte Prozesse nur der Beschreibung des Verhaltens des Prozesses dienen,  können ausführbare BPEL-Prozesse, wie der Name schon sagt, in einer BPEL-Engine ausgeführt werden. Da der Kontext dieser Arbeit das Testen von BPEL-Prozessen ist, und das Testen die Ausführung voraussetzt, sind dementsprechend auch nur die ausführbaren Prozesse relevant. Die weiteren Betrachtungen in dieser Arbeit beschränken sich aus diesem Grund ausschließlich auf die ausführbaren Prozesse.


Mit BPEL können langlebige und zustandsbehaftete Prozesse modelliert werden. Es ist dabei möglich, eine sehr flexible Fehlerbehandlung mit Kompensationsmöglichkeiten zu realisieren. Durch die strikte Trennung der Geschäftslogik (BPEL-Prozess) und Implementierung (einzelnen Web Services) ist die Anpassung bei Änderungen des zugehörigen Geschäftsprozesses einfach durchzuführen. Bei ausreichend kleiner Granularität der einzelnen Services betreffen die Auswirkungen einer Änderung ausschließlich den BPEL-Prozess selbst.

Die Schnittstelle nach außen eines BPEL-Prozesses wird ebenfalls in WSDl beschrieben und kann wiederum als Web Service in andere Prozesse eingebunden werden.
Die damit gegebene Rekursivität ermöglicht durch hierarchische Aufbau der Prozessen die Abstraktionsschichten einzuführen und damit die Komplexität besser beherrschen.

Allerdings bring BPEL auch einige Nachteile mit sich. Als Erstes ist die Komplexität der Sprache zu nennen. Jedoch ist diese Komplexität in dem Anspruch begründet, jede Art von Geschäftsprozessen realisieren zu können und zwar quer zu allen IT-Plattformen. Auch zu nennen sind die redundanten Ausdrucksmittel der Sprache, die aufgrund der Vereinigung zwei Sprachen entstanden sind, und oft das Verständnis der Prozessen erschweren. Als letztes ist noch das Fehlen einer standardisierten grafischen Notation zu erwähnen.

In den folgenden Abschnitten wird auf einige für diese Arbeit relevanten Aspekte der BPEL eingegangen.

\subsection{Partners}

BPEL-Prozesse interagieren mit anderen Web Services, die
man als Partner oder Partner-Prozesse bezeichnet. Ein
BPEL-Prozess benutzt Dienste von Partnern und bietet selbst Dienste nach außen an. Die Beziehung zwischen den möglichen Partner und dem Prozess selbst wird zuerst abstrakt durch die Rollen in einem Partner Link Type beschrieben. In jedem solchen Element werden mindestens eine und maximal zwei Rollen definiert. Die Rollen können dabei entweder vom Prozess oder vom Partner übernommen werden.  Derjenige der diese Rolle übernimmt muss den PortType, der zu der Rolle zugeordnet ist, in seiner WSDL-Schnittstelle anbieten.

Die Beziehung zwischen dem BPEL-Prozess und einem konkreten Partner wird letztendlich in Partner Link durch die Zuweisung der Rollen definiert.
Die Bindung an einen konkreten Web Service kann entweder statisch zum Zeitpunkt des Deployments oder dynamisch zur Laufzeit erfolgen. Die Abbildung \ref{fig:partnerLink} stellt den ganzen Zusammenhang grafisch dar.
\begin{figure}[htbp]
	\centering
		\includegraphics[width=0.7\textwidth]{bilder/partnerLink.png}
		\caption{Partner Link}
	\label{fig:partnerLink}
\end{figure}

\subsection{BPEL Prozess}
BPEL-Prozess ist definiert in Form eines XML-Dokuments. Die Wurzel eines BPEL-Dokuments ist das Element <process>, welches die Struktur und den
Kontrollfluss eines Geschäftsprozesses in sich kapselt. Das Prozess-Element enthält drei wichtige Abschnitte:

\begin{itemize}
	\item Partner Links-Enthält Partner Link-Definitionen (siehe...), werden für Kommunikation mit den Partner benutzt.   
	\item Variables Platz für die Speicherung von internen Daten und Daten, die Empfangen oder Gesendet werden. Datentypen ...  Alle Variablen sind globale Variablen. Es gibt Möglichkeit lokale Variablen zu definieren.  Variable Analog zu anderen Programmiersprachen bietet auch BPEL dieM¨oglichkeit,
Daten in Variablen zu speichern. Sie werden in einem Sichtbarkeitsbereich
(scope) durch einen eindeutigen Namen und einen Datentyp definiert. Each <variable> is declared within a <scope> and is said to belong to that scope. Variables that
belong to the global process scope are called global variables. Variables may also belong to other,
non-global scopes, and such variables are called local variables. Each variable is visible only in
the scope in which it is defined and in all scopes nested within the scope to which it belongs. The messageType, type or element attributes are used to specify the type of a
variable. Exactly one of these attributes MUST be used. Attribute messageType refers to a
WSDL message type definition. Attribute type refers to an XML Schema type (simple or
complex). Attribute element refers to an XML Schema element.
	\item Aktivitäten Enthält die Geschäftslogik in Form von Aktivitäten. 
\end{itemize}
 
Die Geschäftslogik wird in BPEL durch so genannte Aktivitäten realisiert. Es gibt zwei Arten von Aktivitäten: Basisaktivitäten (basic activities) und Strukturierte Aktivitäten (structured activities). Basic activities are those which describe elemental steps of the process behavior.
Structured activities encode control-flow logic, and therefore can contain other basic and/or
structured activities recursively.

Die Basisaktivitäten sind: 
\begin{itemize}
\item invoke dient dazu, andere Web Services aus dem Prozess heraus aufzurufen. 
\item receive Blockierendes Warten auf Nachrichten Mit <receive> kann auch eine Prozessinstanz aktiviert werden.
\item reply Versendet eine Antwort
\item assign Manipulation von Variablenwerten Kopiert Daten von einer Variablen zu einer anderen. So wird das Ergebnis eines Services an den nächsten übergeben. zum Kopieren von Daten von einer Variable zur nachsten,
auch unter Verwendung von Ausdrucken (Expressions).
\item throw Explizites Signalisieren eines Fehlers, welcher durch Fehlerbehandlungen aufgefangen werden kann. 
\item exit Beenden einer Prozessinstanz 
\item wait  Warten auf einen Zeitpunkt oder für eine Zeitspanne
\item empty Nichts machen (NOP)
\item compensate Kompensation aller eingebetteten Scopes in der standardmäßigen
Kompensationsreihenfolge(siehe ..) compensate ist direkt im Fault- oder standardm¨aßigen Compensation-
Handler eingebettet. compensate kann nur im FaultHandler
oder CompensationHandler eingebettet sein.)
\item compensateScope zur Kompensation
eines speziellen Scope
\item rethrow Wieterreichen der Abgefangenen Fehler
\item validate
	\end{itemize}
Mit den ersten drei lassen sich alle Kommunikationsszenarien implementieren:
\begin{itemize}
	\item synchrone request\/response-Operation
	\item asynchrone request\/response-Operation
	\item Kommunikation in eine Richtung
\end{itemize}

evtl Invoke genauer



Strukturierte Aktivitäten bestimmen die Reihenfolge in der die eingeschloßene Aktivitäten ausgeführt werden. Können geschachtelt werden.
WS-BPEL beschreibt den Ablauf von Geschäftsprozessen als strukturierte Aktivitäten.
\begin{itemize}
\item sequence \- Die sequence-Aktivität erlaubt es, mehrere atomare oder strukturierte Aktivitäten sequenziell auszuführen.
\item if \- The if activity provides conditional behavior. The activity consists of an ordered list of one or
more conditional branches defined by the <if> and optional <elseif> elements, followed by an
optional <else> element. The <if> and <elseif> branches are considered in the order in which
they appear. The first branch whose <condition> holds true is taken, and its contained activity
is performed.
\item while \- Eine while-Schleife; iterative Ausführung von Aktivitäten, bis die Bedingung erfüllt
ist. Es ist die einzige Möglichkeit
\item repeatUntil \-
\item forEach \-
\item pick \- Blockierendes Warten auf  Eintreffen eines von mehreren Ereignissen. Ereignisse können dabei entweder spezifizierten Nachrichten oder zeitbasiserte Ereignisse sein.Bei dieser strukturierenden Aktivität wird ein Zweig aus mehreren anhand eines Ereignisses (Nachricht oder Alarm) ausgewählt. Wurde ein zutreffendes Ereignis empfangen, so wird die zugehörige Aktivität ausgeführt und alle nachfolgenden Ereignisse verworfen. Aus der Sicht des Kontrollflusses stimmt dieses Verhalten mit dem einer IF-\-Akti\-vi\-tät überein. Deswegen werden diese beiden Aktivitäten im Kontrollfluss durch gleiche Graphen repräsentiert.
\item flow \- ermöglicht parallele Ausführung von Aktivitäten mit Synchronisationsmöglichkit (siehe ..).  Mit der \textit{Flow}-Aktivität wird in BPEL paralleler Ablauf mehrerer Aktivitäten realisiert. Außerdem gibt es mit dem Link-Konzept, ein mächtiges Instrument, das ermöglicht, Syn\-chro\-ni\-sa\-tions\-ab\-hän\-gig\-keiten aufzustellen und damit komplexe Abläufe zu realisieren. Die rechte Abbildung zeigt den zugehörigen Kontrollfluss. 
\item scope \- Dient zur Strukturierung von BPEL-Prozessen.  Ist ein Ausfuhrungskontext für Aktivitäten mit der Möglichkeit,  eigene Fault Handler zu definieren.  transaktionalen Einheit zusammengefasst werden. Durch einen Scope kann einer Gruppe von Aktivitäten ein Fehlerbehandler (fault handler), Ereignisbehandler (event handler) und ein Kompensationsbehandler (compensation handler) zugeordnet werden. Durch den Kompensationsbehandler werden lang-andauernde Transaktionen ermöglicht.
Bettet eine Aktivit¨at ein und bindet sie an einen FaultHandler,
einen CompensationHandler und optional einen EventHandler an. Ein
scope ist ein Sichtbarkeitsbereich f¨ur in ihm deklarierte Variablen
\end{itemize}

Die ersten drei entsprechen den konventionellen strukturierten Programmierung

\subsection{Link-Konzept}%DPE
Link-Konzept In einer flow-Aktivit¨at k¨onnen Links definiert werden. Sie dienen
der Synchronisation nebenl¨aufiger Aktivit¨aten. Jeder Link verbindet eine
source- (Start-) mit einer target- (Ziel-) Aktivit¨at. Ein Link kann entweder
undefiniert sein oder einen booleschenWert (transitionCondition) haben. Ist
eine Aktivit¨at target-Aktivit¨at eines oder mehrerer Links und haben alle eingehenden
Links einen definierten Wert, wird eine joinCondition ausgewertet.
Ist sie wahr (
true), so wird die Aktivit¨at ausgef¨uhrt, andernfalls nicht.
Wird eine Aktivit¨at aufgrund einer zu
false ausgewerteten joinCondition
oder eines nicht abgearbeiteten Zweiges einer switch- oder pick-Aktivit¨at nicht
ausgef¨uhrt, so wird f¨ur alle eventuell vorhandenen ausgehenden Links die transitionCondition
auf falsch gesetzt. So k¨onnen alle target-Aktivit¨aten geeignet
auf den Fehler reagieren. Dieses Verhalten wird als Dead-Path-Elimination
bezeichnet.
Oft ist die vollkommen parallele Ausführung verschiedener Aktivitäten nicht möglich, da beispielsweise Abhängigkeiten zwischen den Aktivitäten bestehen. Die Modellierung solcher Abhängigkeiten erfolgt in BPEL über so genannte Links. An dem nun folgenden Beispiel sollen Syntax und Semantik dieser Links für eine etwas komplexere flow-Aktivität dargestellt werden.
Zusätzlich zu der recht einfachen Synchronisation mit Source/Target lassen sich komplexere Übergangsbedingungen definieren. Dazu wird auf das optionale Attribut joinCondition einer Aktivität zurückgegriffen. Mittels der Funktion getLinkStatus lässt sich feststellen, ob die Aktivität auf Source-Seite des Links bereits abgeschlossen ist oder nicht. Innerhalb des joinCondition-Attributs kann mit getLinkStatus auf die Zustände verschiedener Links zugegriffen werden, wobei diese mit boolschen Operatoren zu komplexen Ausdrücken verknüpft werden können. Erst, wenn joinCondition zu true ausgewertet wird, darf die entsprechende Aktivität starten. Standardmäßig sind alle in einer Aktivität verwendeten target-Links mittels AND verknüpft. Das folgende Code-Fragment zeigt, wie zwei target-Links mittels OR verknüpft sind:
Alle Aktivitäten in BPEL enthalten drei optionale Attribute name, joinCondition und suppress-
JoinFailure. Die beiden letzten Attribute werden im Zusammenhang mit der Synchronisation von
konkurrierenden Pfaden benutzt. DesWeiteren besitzt jede Aktivität zwei optionale Elemente <source>
und <target>, 

explizit gestellte Restriktionen:
 Je zwei Aktivitäten dürfen nur durch maximal einen Link verbunden sein.
 Links, deren Quelle im XML-Teilbaum der dazugehörigen Zielaktivität definiert ist, sind
nicht gestattet.
 Für den Fall, dass zwei ineinander geschachtelte <flow>-Aktivitäten je einen Link mit
dem gleichen Namen definieren, wird die Namensauflösung von innen nach außen betrieben,
d.h. weiter außen stehende Links werden von weiter innen stehenden Links mit
gleichem Namen überladen.
 Ausgehende Links von Fault und Termination Handler (spezieller Handler für die erzwungene
Terminierung von Aktivitäten, siehe 3.9), müssen auf negative gesetzt werden,
sobald feststeht, dass diese nicht abgearbeitet werden.

\subsection{Eventhandler}
Innerhalb eines Scope können zudem
Event Handler definiert werden, über die auf eintreffende Nachrichten oder zeitgesteuerte
Ereignisse reagiert werden kann.EventHandler 
 BPEL bietet die Möglichkeit, parallel zum normalen Kontrollfluss bestimmte Ereignisse
mit sogenannten Eventhandlern zu behandeln. Eventhandler werden mit einem
bestimmten scope innerhalb des Prozesses oder dem globalen Prozess scope verknüpft.
Sie behandeln Ereignisse, die den zugeordneten Gültigkeitsbereich betreffen.
Innerhalb eines Eventhandlers können beliebige Abfolgen von BPEL Aktivitäten definiert
werden.
Der Empfang von Nachrichten stellt eine mögliche Art von Ereignissen dar. Es können
Nachrichten behandelt werden, welche bestimmten Interaktionsmustern entsprechen,
dazu zählen synchrone Request-Response Interaktionen und asynchrone One-Way-
Nachrichten. Eventhandler für diese Ereignisse werden durch das Konstrukt onEvent
beschrieben. Ein Beispiel ist die Statusabfrage, in deren Verlauf verschiedene Zustandsdaten
der Prozessinstanz an den Aufrufer zurückgegeben werden. Auch die Terminierung
einer bestimmten Prozessinstanz über das Senden einer Nachricht kann auf
diese Weise ermöglicht werden.

Die zweite Art von Ereignissen sind zeitabhängige Alarme. Dabei kann es sich um
das Ablaufen einer vorgegebenen Zeitspanne handeln oder ein zuvor definierter Zeitpunkt
wird erreicht. Die Definition von Regeln für Alarme kann standardmäßig mit
XPath erfolgen. BPEL erlaubt auch die Verwendung anderer eindeutig definierter Beschreibungssprachen
für diesen Zweck. Eventhandler für Alarme werden durch das
Konstrukt onAlarm spezifiziert. Durch einen Alarm kann zum Beispiel eine maximale
Gültigkeitszeit einer Prozessinstanz vorgegeben werden, nach deren Ablauf sich
die Prozessinstanz automatisch selbst beendet.

Innerhalb eines Scope können zudem
Event Handler definiert werden, über die auf eintreffende Nachrichten oder zeitgesteuerte
Ereignisse reagiert werden kann.

\subsection{Fehlerbehandlung und Kompensation}
  BPEL-Sprache hat wie viele moderne Programmiersprachen ein Konzept zur strukturierten Behandlung von Laufzeitfehlern.
  Tritt ein Fehler im laufenden Prozess auf, so wird ein für diesen Bereich zuständiger FaultHandler aufgerufen. 
  Oft müssen im Fehlerfall bereits abgeschlossene Aktivitäten kompensiert werden. In BPEL kann
dafür ein Compensation Handler definiert werden, in dem Aktivitäten für die Kompensation festgelegt werden.
Compensation Handler können nur aus Fault Handler oder Compensation Handler des umschließenden Scopes aufgerufen werden. Ein Compensation Handler kann nur für Scopes aufgerufen werden, die
ordnungsgemäß abgearbeitet wurden. Jeder Scope besitz ein Fault und Compensation Handler, der Prozess selbst hat in BPEL 2.0 nur den Fault Handler. 
  
Ist kein nutzerdefiniertes Fault Handler spezifiziert, so gibt es ein impliziter Fault Handler, der die CompensationHandler
aller direkt eingeschlossener Scopes in der umgekehrten Reihenfolge ihrer Abarbeitung aufruft und
anschließend den Fehler an den umschließenden Scope oder den Prozess selbst weiterreicht. Es können eigene FaultHandler spezifiziert werden, der
je nach Art des auftretenden Fehlers eine bestimmte BPEL-Aktivit¨at ausf¨uhrt. Für die Bindung bestimmter Aktivitäten an die bestimmten Fehler werden catch und catchall-Elemente verwendet. Listing zeigt den Syntax der Handler 

  
Die Fehler können auch in den \textit{Compensation} und in den \textit{FaultHandler} selbst auftreten. In die Abbildung \ref{fig:ScopeFaultCompensation2} wird der Zusammenhang zwischen \textit{Handler} und \textit{Scopes} graphisch dargestellt und durch die Pfeile den möglichen Kontrollfluss zwischen diesen Einheiten gezeigt. 
\begin{figure}[h!]
	\centering
		\includegraphics[width=0.35\textwidth]{bilder/ScopeFaultCompensation2.png}
	\caption{Zusammenhang zwischen Scopes, Fault und Compensation Handler}
	\label{fig:ScopeFaultCompensation2}
\end{figure}

 

implizite Handler
Die Ausnahme stellt hier jedoch die invoke-Aktivität dar. Aufgrund ihrer sehr häufigen Verwendung in BPEL-Prozessen besitzt sie eine eigene Art der Fehlerbehandlung.

\subsection{Prozessinstance}

Die Erzeugung von Prozessinstanzen erfolgt implizit anhand von Aktivit¨aten (receive o. pick),
die externe Nachrichten ¨uber die durch den Prozess definierten Web Service Schnittstellen empfangen. 
Die zur Erzeugung von Prozessinstanzen zu verwendeten Aktivit¨aten
werden hierbei anhand des createInstance=yes Attributs charakterisiert.
Zur
Identifikation von Prozessinstanzen dient, wird als Correlation Set bezeichnet.
Um die Nachrichten an die korrekte Prozessinstanz weitergeben zu können

Prozessinstanzen werden beendet, wenn die Aktivit¨aten, die das Verhalten von Prozessen bestimmen,
abgearbeitet wurden (normale Beendigung), wenn ein Fehler den Prozess-G¨ultigkeitsbereich erreicht,
der entweder behandelt oder nicht behandelt wird, oder wenn von Prozessinstanzen die terminate-
Aktivit¨at zur explizit Beendigung ausgef¨uhrt wurde.


   

\subsection{Engine}



Ein BPEL-Prozess besteht aus der Geschäftslogik (definiert in BPEL), Servicebeschreibung (WSDL) und optional aus weiteren Datentypen (XML Schema). Diese Informationen werden zusammengefasst und in eine BPEL Engine deployt. Die Engine ist unter anderem dafür verantwortlich, die \textit{Endpoints} der Partner des BPEL Prozesses zu spezifizieren. Für jeden Link muss bekannt sein, welche WSDL service und port und welche Addresse für die Kommunikation benutzt werden sollen. Diese Information wird in so genannten Deployment descriptoren festgelegt.
   Das Deployment und die Syntax der Deploymentdescriptoren ist nicht spezifiziert.



  
  
  
  
  
   !!!!!!!The ActiveBPEL(tm) Engine 3.0 Final Release provides comprehensive support for the forthcoming WS-BPEL 2.0 Standard, which will be officially published early in 2007. This release also retains side-by-side execution compatibility with processes based on BPEL4WS 1.1, allowing phased migration to WS-BPEL 2.0. Additional features include enhanced message routing based on WS-Addressing and BPEL sub-process execution.
   

BPEL Engines erlauben das Ausführen von BPEL-Prozessinstanzen. Hierzu müssen die BPEL-Prozesse in die BPEL Engine eingebracht (deployed) und dabei von der jeweiligen BPEL Engine abhängige Deployment-Informationen bereitgestellt werden.

